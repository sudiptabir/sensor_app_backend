# ğŸ“Š ML Alert System - Visual Guide

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         YOUR DEVICE                                 â”‚
â”‚                    LAPTOP-14678VIP                                   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ML Detection Code                        â”‚   â”‚
â”‚  â”‚  â€¢ Person detected at entrance                             â”‚   â”‚
â”‚  â”‚  â€¢ Confidence: 92%                                         â”‚   â”‚
â”‚  â”‚  â€¢ Objects: ["person", "vehicle"]                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                â”‚
â”‚                    â”‚ Create JSON Payload                           â”‚
â”‚                    â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              {                                              â”‚   â”‚
â”‚  â”‚  "deviceId": "192b7a8c-972d...",                           â”‚   â”‚
â”‚  â”‚  "userId": "YOUR_USER_ID",                                 â”‚   â”‚
â”‚  â”‚  "deviceIdentifier": "LAPTOP-14678VIP",                    â”‚   â”‚
â”‚  â”‚  "detectedObjects": ["person", "vehicle"],                 â”‚   â”‚
â”‚  â”‚  "riskLabel": "high",                                      â”‚   â”‚
â”‚  â”‚  "confidenceScore": 0.92                                   â”‚   â”‚
â”‚  â”‚              }                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                â”‚
â”‚                    â”‚ POST request                                  â”‚
â”‚                    â†“                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ HTTPS POST
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FIREBASE CLOUD FUNCTION                           â”‚
â”‚                      receiveMLAlert                                  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. VALIDATE                                                â”‚   â”‚
â”‚  â”‚     â€¢ Check deviceId exists                                â”‚   â”‚
â”‚  â”‚     â€¢ Check userId exists                                 â”‚   â”‚
â”‚  â”‚     â€¢ Check FCM token registered                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                â”‚
â”‚                    â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. SAVE TO FIRESTORE                                       â”‚   â”‚
â”‚  â”‚     Collection: users/{userId}/mlAlerts                    â”‚   â”‚
â”‚  â”‚     Document: {                                            â”‚   â”‚
â”‚  â”‚       id, deviceId, deviceIdentifier,                      â”‚   â”‚
â”‚  â”‚       detectedObjects, riskLabel,                          â”‚   â”‚
â”‚  â”‚       description, screenshots,                            â”‚   â”‚
â”‚  â”‚       confidenceScore, timestamp,                          â”‚   â”‚
â”‚  â”‚       acknowledged, userRating,                            â”‚   â”‚
â”‚  â”‚       accuracyFeedback                                     â”‚   â”‚
â”‚  â”‚     }                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                â”‚
â”‚                    â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  3. SEND FCM NOTIFICATION                                   â”‚   â”‚
â”‚  â”‚     â€¢ Get user FCM token                                  â”‚   â”‚
â”‚  â”‚     â€¢ Create notification message                         â”‚   â”‚
â”‚  â”‚     â€¢ Send via Firebase Cloud Messaging                   â”‚   â”‚
â”‚  â”‚     Title: "ğŸŸ  HIGH - LAPTOP-14678VIP"                    â”‚   â”‚
â”‚  â”‚     Body: "Detected: person, vehicle"                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                â”‚
â”‚                    â”‚ Response: { success: true, alertId, ... }     â”‚
â”‚                    â†“                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ FCM Notification + Firestore Update
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   YOUR PHONE/TABLET                                 â”‚
â”‚                 React Native App                                    â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  RECEIVE NOTIFICATION                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”ƒ ğŸŸ  HIGH - LAPTOP-14678VIP                      â”ƒ    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”ƒ Detected: person, vehicle                     â”ƒ    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›    â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                â”‚
â”‚                    â”‚ User taps notification or opens app            â”‚
â”‚                    â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  REAL-TIME LISTENER UPDATES                                â”‚   â”‚
â”‚  â”‚  â€¢ Detects new alert in Firestore                          â”‚   â”‚
â”‚  â”‚  â€¢ Updates mlAlerts state                                  â”‚   â”‚
â”‚  â”‚  â€¢ Refreshes Alerts tab UI                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                â”‚
â”‚                    â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ALERTS TAB DISPLAYS NEW ALERT                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ ğŸŸ  HIGH - LAPTOP-14678VIP             2:45 PM   â”‚   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ ğŸ” Detected: person, vehicle                   â”‚   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ ğŸ“ Suspicious activity detected               â”‚   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ ğŸ“Š 92%                                         â”‚   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ [Tap to view full details]                            â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚                                                â”‚
â”‚                    â”‚ User taps alert                               â”‚
â”‚                    â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ALERT DETAIL MODAL OPENS                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ ğŸŸ  HIGH RISK ALERT                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ LAPTOP-14678VIP                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â° Jan 24, 2:45 PM                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ” Objects: person, vehicle                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ“ Description: Suspicious activity                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ“Š Confidence: 92%                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ“¸ 2 screenshots                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â­ Rate Accuracy: [1][2][3][4][5][6][7]âœ“[8][9][10] â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ“Š Correct? [Yes] [No]                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ [Delete Alert]  [Close]                            â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  User rates alert as 7 stars, selects "Correct Detection"  â”‚   â”‚
â”‚  â”‚  Rating saved to Firestore                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: Device â†’ App

### Step 1: Device Detects
```
Your ML Model detects: person + vehicle
Confidence: 92%
â†’ Create JSON payload
```

### Step 2: Device Sends
```
POST /receiveMLAlert
{
  "deviceId": "192b7a8c-972d-4429-ac28-4bc73e9a8809",
  "userId": "YOUR_USER_ID",
  ...
}
```

### Step 3: Cloud Function Processes
```
âœ“ Validate deviceId & userId
âœ“ Get FCM token for user
âœ“ Save alert to Firestore
âœ“ Send FCM notification
âœ“ Return success response
```

### Step 4: App Receives
```
âœ“ FCM notification arrives
âœ“ Show notification banner
âœ“ Firestore listener detects new doc
âœ“ Update Alerts tab
```

### Step 5: User Interacts
```
âœ“ User sees notification
âœ“ User opens app/taps alert
âœ“ User rates alert accuracy
âœ“ User can delete alert
âœ“ Rating saved to Firestore
```

---

## UI Flow in App

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PUSH NOTIFICATION            â”‚
â”‚  ğŸŸ  HIGH - LAPTOP-14678VIP          â”‚
â”‚  Detected: person, vehicle          â”‚
â”‚         [TAP TO OPEN]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      APP OPENS / FOREGROUND         â”‚
â”‚      â†“ Real-time listener           â”‚
â”‚      â†“ Detects new alert            â”‚
â”‚      â†“ Updates Alerts tab           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       ALERTS TAB (Consolidated)     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ”´ CRITICAL - DEVICE_1  3:00 PMâ”‚â”‚
â”‚  â”‚ ğŸ” Detected: weapon, person     â”‚â”‚
â”‚  â”‚ ğŸ“Š 95%                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸŸ  HIGH - LAPTOP-14678VIP 2:45PMâ”‚â”‚ â† NEW ALERT
â”‚  â”‚ ğŸ” Detected: person, vehicle    â”‚â”‚
â”‚  â”‚ ğŸ“Š 92%                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               â”‚ [TAP ALERT]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ DETAIL MODAL   â”‚
         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
         â”‚ â”‚ HIGH RISK  â”‚ â”‚
         â”‚ â”‚ Device     â”‚ â”‚
         â”‚ â”‚ Objects    â”‚ â”‚
         â”‚ â”‚ Time       â”‚ â”‚
         â”‚ â”‚ Confidence â”‚ â”‚
         â”‚ â”‚ Screenshotsâ”‚ â”‚
         â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
         â”‚ â”‚ â­ Rating    â”‚
         â”‚ â”‚ ğŸ“Š Correct?  â”‚
         â”‚ â”‚ [Delete]     â”‚
         â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                    â”‚
    [RATE ALERT]      [DELETE ALERT]
         â”‚                    â”‚
         â†“                    â†“
      SAVED TO          REMOVED FROM
      FIRESTORE         APP & FIRESTORE
```

---

## Risk Level Indicators

```
ğŸ”´ CRITICAL (Red)
   â””â”€ Highest priority
   â””â”€ Requires immediate attention
   â””â”€ Multiple major threats detected
   â””â”€ Examples: weapon, intrusion, security breach

ğŸŸ  HIGH (Orange)
   â””â”€ Important alert
   â””â”€ Suspicious activity
   â””â”€ Single major threat detected
   â””â”€ Examples: unauthorized person, breach attempt

ğŸŸ¡ MEDIUM (Yellow)
   â””â”€ Standard alert
   â””â”€ Needs attention
   â””â”€ Potentially suspicious activity
   â””â”€ Examples: unknown vehicle, unusual objects

ğŸŸ¢ LOW (Green)
   â””â”€ Information only
   â””â”€ Low priority
   â””â”€ Normal activity detected
   â””â”€ Examples: known visitor, scheduled event
```

---

## Firestore Data Structure

```
Firestore Database
â”‚
â””â”€â”€ users
    â”‚
    â””â”€â”€ {YOUR_USER_ID}
        â”‚
        â””â”€â”€ mlAlerts (Collection)
            â”‚
            â”œâ”€â”€ {alertId_1}
            â”‚   â”œâ”€â”€ id: "abc123..."
            â”‚   â”œâ”€â”€ deviceId: "192b7a8c-972d..."
            â”‚   â”œâ”€â”€ deviceIdentifier: "LAPTOP-14678VIP"
            â”‚   â”œâ”€â”€ detectedObjects: ["person", "car"]
            â”‚   â”œâ”€â”€ riskLabel: "high"
            â”‚   â”œâ”€â”€ description: ["Alert description"]
            â”‚   â”œâ”€â”€ screenshots: ["url1", "url2"]
            â”‚   â”œâ”€â”€ confidenceScore: 0.92
            â”‚   â”œâ”€â”€ timestamp: 2026-01-24T14:45:00Z
            â”‚   â”œâ”€â”€ acknowledged: false
            â”‚   â”œâ”€â”€ userRating: null
            â”‚   â””â”€â”€ accuracyFeedback: null
            â”‚
            â”œâ”€â”€ {alertId_2}
            â”‚   â””â”€â”€ (Another alert)
            â”‚
            â””â”€â”€ {alertId_3}
                â””â”€â”€ (Another alert)
```

---

## Communication Protocols

### JSON Payload Format
```
POST Request Body:
{
  "deviceId": "192b7a8c-972d-4429-ac28-4bc73e9a8809",    // Required
  "userId": "YOUR_USER_ID",                              // Required
  "deviceIdentifier": "LAPTOP-14678VIP",                 // Optional
  "detectedObjects": ["person", "vehicle"],              // Optional
  "riskLabel": "high",                                   // Optional
  "description": ["Alert description"],                  // Optional
  "screenshots": ["url1", "url2"],                       // Optional
  "confidenceScore": 0.92                                // Optional
}
```

### Success Response
```
{
  "success": true,
  "alertId": "abc123def456ghi789",
  "messageId": "0:1234567890123456789",
  "message": "ML alert received and notification sent"
}
```

### Error Response
```
{
  "error": "User not found"
  // or
  "error": "No FCM token registered"
  // or
  "error": "Missing required: deviceId, userId"
}
```

---

## Real-Time Listener Flow

```
App Starts
    â”‚
    â†“
Initialize Firestore
    â”‚
    â†“
Set up Real-time Listener:
listeners.mlAlerts = listenToUserMLAlerts((alerts) => {
  setMLAlerts(alerts);  // Update state
});
    â”‚
    â”œâ”€ Listener ACTIVE âœ“
    â”‚
    â”œâ”€ Waiting for changes...
    â”‚
    â”œâ”€ Device sends alert â†’ Firestore updates
    â”‚
    â”œâ”€ Listener detects change
    â”‚
    â”œâ”€ Callback triggered with new alerts array
    â”‚
    â”œâ”€ Component state updated
    â”‚
    â”œâ”€ UI re-renders
    â”‚
    â”œâ”€ New alert appears in Alerts tab âœ“
    â”‚
    â””â”€ Repeat...

User navigates away
    â”‚
    â†“
Unsubscribe from listener
    â”‚
    â†“
Listener cleaned up
```

---

## Testing Pyramid

```
                    â–²
                   /\
                  /  \
                 / E2E \           End-to-End Tests
                /  (5)  \          â€¢ Full flow testing
               /          \        â€¢ Real notifications
              /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\       â€¢ App UI testing
             /  Integration \
            /      (10)      \     Integration Tests
           /                  \    â€¢ Cloud Function tests
          /â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\ â€¢ Firestore operations
         /    Unit Tests (20)    \ â€¢ Notification sending
        /                        \
       /                          \
      â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´

Priority Order:
1. Unit: Single functions work âœ“
2. Integration: Functions work together âœ“
3. E2E: Full system works â† YOU ARE HERE
```

---

## Deployment Stages

```
Stage 1: DEVELOPMENT
â”œâ”€ Local testing
â”œâ”€ Firebase Emulator (optional)
â””â”€ Manual testing in console

Stage 2: TESTING (CURRENT)
â”œâ”€ Deploy Cloud Functions â† DO THIS FIRST
â”œâ”€ Run Python test script
â”œâ”€ Verify notifications received
â”œâ”€ Check Alerts tab display
â””â”€ Test rating functionality

Stage 3: INTEGRATION
â”œâ”€ Connect to ML model
â”œâ”€ Send real detections
â”œâ”€ Monitor Firestore
â”œâ”€ Monitor FCM quotas
â””â”€ Verify end-to-end

Stage 4: PRODUCTION
â”œâ”€ High-volume testing
â”œâ”€ Performance monitoring
â”œâ”€ Alert latency tracking
â”œâ”€ User feedback collection
â””â”€ Continuous optimization
```

---

## Performance Metrics

```
Expected Performance:
- Device â†’ Function: < 200ms
- Function â†’ Firestore: < 500ms
- Firestore â†’ Notification: < 1s
- Notification â†’ App: < 2s (depends on network)
- Total: < 4 seconds from detection to app display

Reliability:
- Function success rate: > 99%
- Notification delivery: > 95%
- Firestore write success: > 99%
- App listener uptime: > 99%

Scalability:
- Single device: Unlimited alerts
- Multiple devices: Unlimited alerts
- Batch endpoint: Up to 100 alerts per request
- Concurrent users: Depends on FCM quota
```

---

This visual guide helps you understand how the system works end-to-end!

